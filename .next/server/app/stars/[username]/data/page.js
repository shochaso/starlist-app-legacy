(()=>{var e={};e.id=70,e.ids=[70],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1062:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c});var r=a(7096),n=a(6132),s=a(7284),i=a.n(s),o=a(2564),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);a.d(t,l);let c=["",{children:["stars",{children:["[username]",{children:["data",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,8362)),"/Users/shochaso/Downloads/starlist-app/app/stars/[username]/data/page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,3545)),"/Users/shochaso/Downloads/starlist-app/app/stars/[username]/data/layout.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,5345)),"/Users/shochaso/Downloads/starlist-app/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9291,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/shochaso/Downloads/starlist-app/app/stars/[username]/data/page.tsx"],u="/stars/[username]/data/page",p={require:a,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/stars/[username]/data/page",pathname:"/stars/[username]/data",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5303:()=>{},3545:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>StarDataLayout});var r=a(4656);function StarDataLayout({children:e}){return r.jsx("section",{children:e})}},8362:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>StarDataPage});var r=a(4656),n=a(3542);function Header(){return r.jsx("header",{children:"Header Placeholder"})}async function PackSection({username:e,date:t}){try{let a=Object(function(){var e=Error("Cannot find module '../../../../lib/star-data/repository/supabaseStarDataRepository.node'");throw e.code="MODULE_NOT_FOUND",e}())(),n=await a.fetchPack(Object(function(){var e=Error("Cannot find module '../../../../lib/star-data/utils/buildPackId'");throw e.code="MODULE_NOT_FOUND",e}())(e,t)),s=n.items??[];return(0,r.jsxs)("section",{children:[r.jsx("h2",{children:"Pack details"}),0===s.length?r.jsx("p",{children:"No items in this pack."}):r.jsx("ul",{children:s.map(e=>r.jsx("li",{children:e.title||"Untitled item"},e.id))})]})}catch(e){return console.error("Failed to load pack",e),(0,r.jsxs)("section",{children:[r.jsx("h2",{children:"Pack details"}),r.jsx("p",{children:"Failed to load pack data."})]})}}(function(){var e=Error("Cannot find module '../../../../lib/star-data/utils/buildPackId'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '../../../../lib/star-data/repository/supabaseStarDataRepository.node'");throw e.code="MODULE_NOT_FOUND",e}();var s=a(8771);let i=null;function resolveStarId(e){let t=e.trim().toLowerCase();if(!t||"hanayama-mizuki"===t||"花山瑞樹"===t)return"star_hanayama_mizuki";if("kato-junichi"===t||"加藤純一"===t)return"star_kato_junichi";let a=t.replace(/-/g,"_");return`star_${a.replace(/[^a-z0-9_]/g,"_")}`}let SupabaseStarDataRepository=class SupabaseStarDataRepository{constructor(e){this.options=e}get client(){return this.options.client}async fetchItems(e){var t;let a={p_star_id:resolveStarId((t={username:e.username,date:new Date(e.date),category:e.category,genre:e.genre}).username),p_occurred_at:function(e){let t=new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()));return t.toISOString().split("T")[0]}(t.date),p_category:t.category??null,p_genre:t.genre??null},{data:r,error:n}=await this.client.rpc("get_star_data_items",a);if(n)throw n;let s=Array.isArray(r)?r:[];return s.map(e=>mapStarDataItem(e))}async fetchPack(e){let{data:t,error:a}=await this.client.rpc("get_star_data_pack",{p_pack_id:{packId:e}.packId});if(a)throw a;let r=Array.isArray(t)?t[0]:t;if(!r)throw Error("StarDataPack not found");return function(e){let t=Array.isArray(e.items)?e.items:[];return{packId:String(e.pack_id??e.packId??""),createdAt:String(e.created_at??e.createdAt??new Date().toISOString()),items:t.map(mapStarDataItem)}}(r)}async fetchSummary(e){let{data:t,error:a}=await this.client.rpc("get_star_data_summary",{p_star_id:resolveStarId({username:e}.username)});if(a)throw a;let r=Array.isArray(t)?t[0]:t;if(!r)throw Error("StarDataSummary not found");return{dailyCount:Number(r.daily_count??r.dailyCount??0),weeklyCount:Number(r.weekly_count??r.weeklyCount??0),monthlyCount:Number(r.monthly_count??r.monthlyCount??0),latestCategories:Array.isArray(r.latest_categories)?r.latest_categories.map(e=>String(e)):Array.isArray(r.latestCategories)?r.latestCategories.map(e=>String(e)):[]}}async hideItem(e){let{error:t}=await this.client.from("star_data_items").update({is_hidden:!0,hidden_at:new Date().toISOString()}).eq("id",e);if(t)throw t}};function mapStarDataItem(e){return{id:String(e.id??""),starId:String(e.star_id??e.username??""),date:String(e.occurred_at??e.date??""),category:String(e.category??""),genre:String(e.genre??""),title:String(e.title??""),subtitle:String(e.subtitle??""),source:String(e.source??""),createdAt:String(e.created_at??e.createdAt??""),isHidden:!!e.is_hidden,extra:e.raw_payload??void 0}}async function SummarySection({username:e}){let t=function(){let e=function(){if(i)return i;let e=process.env.NEXT_PUBLIC_SUPABASE_URL,t=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;if(!e||!t)throw Error("NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY must be defined for Supabase access");return i=(0,s.createClient)(e,t,{auth:{persistSession:!1,autoRefreshToken:!1}})}();return new SupabaseStarDataRepository({client:e})}();try{let a=await t.fetchSummary(e),n=a.latestCategories.length?a.latestCategories.join(", "):"None";return(0,r.jsxs)("section",{children:[(0,r.jsxs)("div",{children:["Daily: ",a.dailyCount]}),(0,r.jsxs)("div",{children:["Weekly: ",a.weeklyCount]}),(0,r.jsxs)("div",{children:["Monthly: ",a.monthlyCount]}),(0,r.jsxs)("div",{children:["Latest: ",n]})]})}catch(t){let e=t instanceof Error?t.message:String(t);return(0,r.jsxs)("section",{children:[r.jsx("p",{children:"Failed to load summary."}),r.jsx("p",{children:e})]})}}function TimelineSection(){return r.jsx("section",{children:"Timeline Section"})}function DataPageShell({username:e,date:t}){return(0,r.jsxs)("div",{className:"flex flex-col gap-6",children:[r.jsx(Header,{}),r.jsx(SummarySection,{}),r.jsx(n.Suspense,{fallback:r.jsx("div",{children:"Loading pack …"}),children:r.jsx(PackSection,{username:e,date:t})}),r.jsx(TimelineSection,{})]})}function StarDataPage({params:e}){let{username:t}=e,a=new Date;return r.jsx(DataPageShell,{username:t,date:a})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[472,771,476],()=>__webpack_exec__(1062));module.exports=a})();