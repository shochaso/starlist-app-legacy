"use strict";(()=>{var e={};e.id=624,e.ids=[624],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9655:(e,t,i)=>{i.r(t),i.d(t,{headerHooks:()=>p,originalPathname:()=>m,requestAsyncStorage:()=>l,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d,staticGenerationBailout:()=>c});var r={};i.r(r),i.d(r,{GET:()=>GET}),i(8976);var o=i(884),a=i(6132),s=i(5798);let n=["maxres","standard","high","medium","default"];let YoutubeClient=class YoutubeClient{constructor(e=process.env.YOUTUBE_API_KEY){if(this.baseUrl="https://www.googleapis.com/youtube/v3",!e)throw Error("YOUTUBE_API_KEY is not set.");this.apiKey=e}async fetchVideoById(e){if(!e)throw Error("videoId is required");let t=new URL(`${this.baseUrl}/videos`);t.search=new URLSearchParams({part:"snippet,statistics",id:e,key:this.apiKey}).toString();let i=await fetch(t.toString(),{cache:"no-store"});if(!i.ok)return console.error("[YoutubeClient] videos API failed",i.status,await i.text()),null;let r=await i.json(),o=r.items?.[0];return o?this.mapVideo(o):null}async searchVideos(e,t){if(!e.trim())return[];let i=this.normalizeMaxResults(t?.maxResults),r=new URL(`${this.baseUrl}/search`);r.search=new URLSearchParams({part:"snippet",type:"video",q:e,maxResults:String(i),key:this.apiKey}).toString();let o=await fetch(r.toString(),{cache:"no-store"});if(!o.ok)return console.error("[YoutubeClient] search API failed",o.status,await o.text()),[];let a=await o.json();return a.items?.length?a.items.map(e=>this.mapVideo({...e,id:e?.id?.videoId??e?.id})).filter(e=>!!e):[]}normalizeMaxResults(e){return!e||Number.isNaN(e)?5:Math.min(Math.max(Math.floor(e),1),20)}mapVideo(e){let t=e?.snippet;if(!t)return null;let i="string"==typeof e?.id?e.id:e?.id?.videoId;if(!i)return null;let r=e?.statistics,o=r?.viewCount,a="string"==typeof o&&o.length>0?Number(o):void 0;return{id:i,title:t.title??"",channelTitle:t.channelTitle??"",publishedAt:t.publishedAt??"",thumbnailUrl:this.resolveThumbnail(t)??null,viewCount:Number.isFinite(a)?a:void 0}}resolveThumbnail(e){let t=e?.thumbnails??{};for(let e of n){let i=t[e]?.url;if(i)return i}return null}};async function GET(e){let t=new URL(e.url),i=t.searchParams.get("videoId");if(!i)return s.Z.json({error:"Missing videoId"},{status:400});try{let e=new YoutubeClient,t=await e.fetchVideoById(i);if(!t)return s.Z.json({error:"Video not found"},{status:404});return s.Z.json(t,{status:200})}catch(e){return console.error("[api/youtube/video] failed to fetch video",e),s.Z.json({error:"Failed to fetch video data"},{status:502})}}let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/youtube/video/route",pathname:"/api/youtube/video",filename:"route",bundlePath:"app/api/youtube/video/route"},resolvedPagePath:"/Users/shochaso/Downloads/starlist-app/app/api/youtube/video/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:h,headerHooks:p,staticGenerationBailout:c}=u,m="/api/youtube/video/route"}};var t=require("../../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),i=t.X(0,[955],()=>__webpack_exec__(9655));module.exports=i})();